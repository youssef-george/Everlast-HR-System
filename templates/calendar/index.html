{% extends "layout.html" %}

{% block extra_css %}
<style>
    /* Modern Calendar Styling */
    
    .calendar-loading {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        display: none;
        backdrop-filter: blur(5px);
    }
    
    .calendar-loading .spinner-border {
        width: 3rem;
        height: 3rem;
        border-width: 0.3rem;
    }
    
    /* FullCalendar Custom Styling */
    .fc {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    .fc-header-toolbar {
        margin-bottom: 2rem !important;
        padding: 1.5rem;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        border-radius: 1rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    }
    /* Ensure toolbar chunks space nicely */
    .fc-header-toolbar .fc-toolbar-chunk { gap: 0.5rem; }
    
    .fc-toolbar-title {
        font-size: 1.75rem !important;
        font-weight: 700 !important;
        color: #1f2937 !important;
        text-transform: capitalize;
    }
    
    .fc-button {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%) !important;
        border: none !important;
        border-radius: 0.75rem !important;
        padding: 0.75rem 1.5rem !important;
        font-weight: 600 !important;
        text-transform: none !important;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3) !important;
        transition: all 0.3s ease !important;
        pointer-events: auto !important;
    }
    
    /* Style the Today button with icon */
    .fc-today-button {
        position: relative !important;
    }
    
    .fc-today-button::before {
        content: '\f073' !important;
        font-family: 'Font Awesome 6 Free' !important;
        font-weight: 900 !important;
        margin-right: 0.5rem !important;
    }
    
    /* Style the prev/next buttons with icons */
    .fc-prev-button::before {
        content: '\f053' !important;
        font-family: 'Font Awesome 6 Free' !important;
        font-weight: 900 !important;
    }
    
    .fc-next-button::before {
        content: '\f054' !important;
        font-family: 'Font Awesome 6 Free' !important;
        font-weight: 900 !important;
    }
    
    .fc-prev-button,
    .fc-next-button {
        font-size: 0 !important; /* hide text, we show icon via ::before */
        width: 48px !important;
        padding: 0.75rem !important;
    }
    .fc-prev-button { border-top-right-radius: 0.75rem !important; border-bottom-right-radius: 0.75rem !important; }
    .fc-next-button { border-top-left-radius: 0.75rem !important; border-bottom-left-radius: 0.75rem !important; }
    /* Hide Week/Day/List buttons if any residual styles render them */
    .fc-timeGridWeek-button,
    .fc-timeGridDay-button,
    .fc-listWeek-button { display: none !important; }
    
    .fc-button:hover {
        transform: translateY(-2px) !important;
        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4) !important;
    }
    
    .fc-button:focus {
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2) !important;
    }
    
    .fc-button-active {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%) !important;
    }
    .fc-button:disabled,
    .fc-button.fc-button-disabled {
        opacity: 0.6 !important;
        cursor: not-allowed !important;
        box-shadow: none !important;
    }
    
    .fc-daygrid-day {
        border-radius: 0.5rem !important;
        margin: 0.25rem !important;
        transition: all 0.3s ease !important;
    }
    
    .fc-daygrid-day:hover {
        background-color: rgba(99, 102, 241, 0.05) !important;
    }
    
    .fc-day-today {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%) !important;
        border-radius: 0.75rem !important;
    }
    
    .fc-daygrid-day-number {
        font-weight: 600 !important;
        color: #374151 !important;
        padding: 0.75rem !important;
    }
    
    .fc-day-today .fc-daygrid-day-number {
        color: #6366f1 !important;
        font-weight: 700 !important;
    }
    
    .fc-daygrid-day-events {
        margin: 0.25rem !important;
    }
    
    .fc-event {
        cursor: pointer !important;
        border-radius: 0.5rem !important;
        padding: 0.25rem 0.5rem !important;
        margin: 0.125rem 0 !important;
        font-size: 0.8rem !important;
        font-weight: 500 !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
        transition: all 0.3s ease !important;
        border: none !important;
    }
    
    .fc-event:hover {
        transform: translateY(-1px) !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
    }
    
    .modern-event {
        border-radius: 0.5rem !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
        transition: all 0.3s ease !important;
    }
    
    .modern-event:hover {
        transform: translateY(-1px) !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
    }
    
    .fc-daygrid-event {
        border-radius: 0.5rem !important;
    }
    
    .fc-daygrid-event-dot {
        display: none !important;
    }
    
    .fc-daygrid-event-harness {
        margin: 0.125rem 0 !important;
    }
    
    .fc-daygrid-day-frame {
        border-radius: 0.5rem !important;
    }
    
    .fc-scrollgrid {
        border-radius: 1rem !important;
        overflow: hidden !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08) !important;
    }
    
    .fc-col-header-cell {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%) !important;
        font-weight: 600 !important;
        color: #374151 !important;
        padding: 1rem !important;
        text-transform: uppercase !important;
        font-size: 0.875rem !important;
        letter-spacing: 0.05em !important;
    }
    
    .fc-daygrid-day-frame {
        min-height: 120px !important;
    }
    
    /* Ensure calendar shows all dates properly */
    .fc-daygrid-day {
        min-height: 120px !important;
    }
    
    .fc-daygrid-day-number {
        font-size: 1rem !important;
        font-weight: 600 !important;
    }
    
    /* Make sure all dates (past, present, future) are visible */
    .fc-day-today {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%) !important;
        border-radius: 0.75rem !important;
        font-weight: 700 !important;
    }
    
    /* Ensure past days are fully visible and clickable */
    .fc-daygrid-day {
        opacity: 1 !important;
        visibility: visible !important;
        pointer-events: auto !important;
    }
    
    /* Style past days differently to show they're historical */
    .fc-daygrid-day.fc-day-past {
        background-color: rgba(248, 250, 252, 0.5) !important;
        color: #6b7280 !important;
    }
    
    .fc-daygrid-day.fc-day-past .fc-daygrid-day-number {
        color: #6b7280 !important;
        font-weight: 500 !important;
    }
    
    /* Style future days */
    .fc-daygrid-day.fc-day-future {
        background-color: rgba(255, 255, 255, 0.8) !important;
        color: #374151 !important;
    }
    
    .fc-daygrid-day.fc-day-future .fc-daygrid-day-number {
        color: #374151 !important;
        font-weight: 500 !important;
    }
    
    .fc-day-today .fc-daygrid-day-number {
        color: #6366f1 !important;
        font-weight: 700 !important;
        font-size: 1.1rem !important;
    }
    
    /* Enhanced Mobile Responsive Design */
    @media (max-width: 768px) {
        .calendar-stats {
            grid-template-columns: 1fr;
        }
        
        .calendar-filter-group {
            flex-direction: column;
            gap: 1rem;
        }
        
        .fc-header-toolbar {
            flex-direction: column;
            gap: 0.75rem;
            padding: 1rem;
        }
        
        .fc-toolbar-chunk {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .fc-toolbar-title {
            font-size: 1.25rem !important;
            text-align: center;
            margin: 0.5rem 0;
        }
        
        .fc-button {
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
        }
        
        .fc-prev-button,
        .fc-next-button {
            width: 40px !important;
            padding: 0.5rem !important;
        }
        
        .fc-today-button {
            padding: 0.5rem 1rem !important;
            font-size: 0.8rem !important;
        }
        
        .fc-daygrid-day {
            min-height: 80px !important;
        }
        
        .fc-daygrid-day-number {
            font-size: 0.9rem !important;
            padding: 0.5rem !important;
        }
        
        .fc-event {
            font-size: 0.7rem !important;
            padding: 0.125rem 0.25rem !important;
            margin: 0.0625rem 0 !important;
        }
        
        .fc-daygrid-event {
            font-size: 0.7rem !important;
        }
        
        .card-header {
            padding: 0.75rem;
        }
        
        .card-header h3 {
            font-size: 1.1rem;
        }
        
        .form-select {
            font-size: 16px;
            padding: 0.5rem;
        }
    }
    
    @media (max-width: 576px) {
        .fc-header-toolbar {
            padding: 0.75rem;
        }
        
        .fc-toolbar-title {
            font-size: 1.1rem !important;
        }
        
        .fc-button {
            padding: 0.375rem 0.5rem;
            font-size: 0.75rem;
        }
        
        .fc-prev-button,
        .fc-next-button {
            width: 36px !important;
            padding: 0.375rem !important;
        }
        
        .fc-today-button {
            padding: 0.375rem 0.75rem !important;
            font-size: 0.75rem !important;
        }
        
        .fc-daygrid-day {
            min-height: 70px !important;
        }
        
        .fc-daygrid-day-number {
            font-size: 0.8rem !important;
            padding: 0.375rem !important;
        }
        
        .fc-event {
            font-size: 0.65rem !important;
            padding: 0.1rem 0.2rem !important;
        }
        
        .fc-daygrid-event {
            font-size: 0.65rem !important;
        }
        
        .card-header {
            padding: 0.5rem;
        }
        
        .card-body {
            padding: 0.5rem;
        }
        
        .form-select {
            font-size: 16px;
            padding: 0.375rem;
        }
    }
    
    /* Custom scrollbar for calendar */
    .fc-scroller::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }
    
    .fc-scroller::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 4px;
    }
    
    .fc-scroller::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        border-radius: 4px;
    }
    
    .fc-scroller::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
    }
    
    /* Additional utility classes */
    .bg-gradient-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    }
    
    .bg-gradient-light {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%) !important;
    }
    
    .shadow-lg {
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1) !important;
    }
    
    .border-0 {
        border: none !important;
    }
    
    .text-primary {
        color: #6366f1 !important;
    }
    
    .fw-semibold {
        font-weight: 600 !important;
    }
    
    .gap-2 {
        gap: 0.5rem !important;
    }
    
    .gap-3 {
        gap: 1rem !important;
    }
    
</style>
{% endblock %}

{% block content %}
<div class="content-header mb-4">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 class="page-title mb-2">
                <i class="fas fa-calendar-alt me-3 text-primary"></i>
                Calendar Dashboard
            </h1>
            <p class="text-muted mb-0">Manage and view all leave requests, permissions, and attendance records</p>
        </div>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-12">
        <div class="card border-0 shadow-lg">
            <div class="card-header" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-calendar-week me-2 text-primary"></i>
                        Interactive Calendar
                    </h3>
                    {% if current_user.role in ['admin', 'director', 'manager'] %}
                    <div class="d-flex align-items-center gap-3">
                        <label for="userFilter" class="form-label mb-0 fw-semibold text-muted">Filter by Employee:</label>
                        <select id="userFilter" class="form-select form-select-lg" style="width: 250px;">
                            <option value="">All Employees</option>
                            {% for user in all_users %}
                                <option value="{{ user.id }}" {% if request.args.get('user_id')|int == user.id %}selected{% endif %}>
                                    {{ user.get_full_name() }}
                                    {% if user.department %}({{ user.department.department_name }}){% endif %}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="card-body position-relative p-0">
                <div id="calendar-loading" class="calendar-loading">
                    <div class="text-center">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <h5 class="text-muted">Loading calendar events...</h5>
                    </div>
                </div>
                <div id="calendar" class="p-4" style="min-height: 600px;"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/calendar.js') }}"></script>
{% endblock %}
