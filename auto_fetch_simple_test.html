<!DOCTYPE html>
<html>
<head>
    <title>Auto-Fetch Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .stat { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .pending-leave-count { color: red; font-weight: bold; }
        .pending-permission-count { color: orange; font-weight: bold; }
        .total-employees-count { color: blue; font-weight: bold; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body data-user-role="admin">
    <h1>Auto-Fetch Test Page</h1>
    
    <div class="stat">
        <h3>Pending Leave Requests: <span class="pending-leave-count">0</span></h3>
    </div>
    
    <div class="stat">
        <h3>Pending Permission Requests: <span class="pending-permission-count">0</span></h3>
    </div>
    
    <div class="stat">
        <h3>Total Employees: <span class="total-employees-count">0</span></h3>
    </div>
    
    <div class="log" id="logs">
        <h4>Console Logs:</h4>
        <div id="log-content"></div>
    </div>
    
    <script>
        // Capture console logs
        const originalLog = console.log;
        const originalError = console.error;
        
        function addLog(message) {
            const logDiv = document.getElementById('log-content');
            const logEntry = document.createElement('div');
            logEntry.textContent = '[' + new Date().toLocaleTimeString() + '] ' + message;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog('ERROR: ' + args.join(' '));
        };
        
        // Test API call
        async function testAPI() {
            try {
                console.log('Testing API call...');
                const response = await fetch('/api/dashboard/stats');
                const data = await response.json();
                console.log('API Response: ' + JSON.stringify(data));
                
                if (data.status === 'success' && data.data) {
                    const stats = data.data;
                    if (stats.pending_leave_requests !== undefined) {
                        document.querySelector('.pending-leave-count').textContent = stats.pending_leave_requests;
                    }
                    if (stats.pending_permission_requests !== undefined) {
                        document.querySelector('.pending-permission-count').textContent = stats.pending_permission_requests;
                    }
                    if (stats.total_employees !== undefined) {
                        document.querySelector('.total-employees-count').textContent = stats.total_employees;
                    }
                    console.log('Stats updated successfully');
                }
            } catch (error) {
                console.error('API test failed: ' + error.message);
            }
        }
        
        // Test after 2 seconds
        setTimeout(testAPI, 2000);
    </script>
    
    <script src="static/js/auto-fetch.js"></script>
</body>
</html>