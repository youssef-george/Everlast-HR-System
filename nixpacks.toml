[phases.setup]
nixPkgs = ["python3", "gcc"]
nixLibs = ["zlib", "stdenv.cc.cc.lib"]

[phases.install]
dependsOn = ["setup"]
cmds = [
  "python -m venv --copies /opt/venv",
  ". /opt/venv/bin/activate",
  "pip install --upgrade pip setuptools wheel",
  "pip install --no-cache-dir --timeout=300 -r requirements.txt"
]
cacheDirectories = ["/root/.cache/pip"]
paths = ["/opt/venv/bin"]

[start]
cmd = "/opt/venv/bin/gunicorn --bind 0.0.0.0:${PORT:-5000} --workers 2 --threads 2 --timeout 120 --access-logfile - --error-logfile - --log-level info main:app"

[variables]
PYTHONUNBUFFERED = "1"
PYTHONDONTWRITEBYTECODE = "1"
PIP_DEFAULT_TIMEOUT = "300"
PIP_NO_CACHE_DIR = "1"
